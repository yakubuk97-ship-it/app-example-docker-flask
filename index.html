<!-- —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã, –æ—Ç–ª–∏—á–∞—é—â–∏–µ—Å—è –æ—Ç –≤–∞—à–µ–≥–æ -->
  <main id="screen-home" class="content">
    <div class="grid">
      <div class="tile" data-route="home">–ì–ª–∞–≤–Ω–∞—è</div>
      <div class="tile" data-route="shop">–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω—ã</div>
      <div class="tile" data-route="fav">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
      <div class="tile" data-route="cart">–ö–æ—Ä–∑–∏–Ω–∞</div>
      <div class="tile" data-route="calc">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
      <div class="tile" data-route="acc">–ê–∫–∫–∞—É–Ω—Ç</div>
    </div>

    <div class="actions">
      <button class="btn" id="pingBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/ping</button>
      <button class="btn" id="refBtn">–ó–æ–≤–∏ –¥—Ä—É–∑–µ–π</button>
      <button class="btn" id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å WebApp</button>
    </div>
    <pre id="log" class="pre" style="display:none"></pre>
  </main>

  ...
<script>
  const tg = window.Telegram?.WebApp;
  if (tg){ tg.ready(); tg.expand(); }

  const $  = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  // ---- UI –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–∫–∞–∫ —É –≤–∞—Å) ----
  function show(route){
    ['home','shop','fav','cart','calc','acc'].forEach(r=>{
      $('#screen-'+r).style.display = (r===route)?'block':'none';
    });
    $$('#nav .nav-btn').forEach(b=>{
      b.classList.toggle('active', b.dataset.route===route);
    });
  }
  $$('.tile').forEach(t => t.addEventListener('click', ()=> show(t.dataset.route)));
  $$('#nav .nav-btn').forEach(b => b.addEventListener('click', ()=> show(b.dataset.route)));

  // ---- –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä/–ø–∏–Ω–≥/–∑–∞–∫—Ä—ã—Ç—å (–∫–∞–∫ —É –≤–∞—Å) ----
  // ...

  // ---- –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–∫–∞–∫ —É –≤–∞—Å, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI) ----
  // ...

  // ---- –ó–æ–≤–∏ –¥—Ä—É–∑–µ–π ----
  async function getRefLink() {
    const init_data = tg?.initData || '';
    const r = await fetch('/api/ref/link', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ init_data })
    });
    return r.json();
  }
  function shareInTelegram(url, text) {
    const share = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
    if (tg?.openTelegramLink) tg.openTelegramLink(share);
    else window.open(share, '_blank');
  }
  $('#refBtn').onclick = async () => {
    try {
      const res = await getRefLink();
      if (!res.ok) {
        tg?.showAlert?.('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É: ' + (res.error || ''));
        return;
      }
      const link = res.link;
      const text = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è! –ü–æ–ª—É—á–∏—à—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã üëá';
      shareInTelegram(link, text);
      try {
        await navigator.clipboard.writeText(link);
        tg?.showPopup?.({ title:'–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', message: link, buttons:[{type:'close'}] });
      } catch (_) {}
    } catch (e) {
      tg?.showAlert?.('–û—à–∏–±–∫–∞: ' + e.message);
    }
  };

  // (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) —Å–æ–æ–±—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—É –æ –≤–∏–∑–∏—Ç–µ —Å —Ä–µ—Ñ-–∫–æ–¥–æ–º
  (async () => {
    try {
      const init_data = tg?.initData || '';
      await fetch('/api/ref/register_visit', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ init_data })
      });
    } catch (_) {}
  })();
</script>
</body>
</html>
